'use client'

import { useEffect } from 'react'
import { useRouter } from 'next/navigation'

interface AutoLogoutEvent extends CustomEvent {
  detail: {
    message: string
    type: 'warning' | 'error' | 'info'
  }
}

export default function AuthHandler() {
  const router = useRouter()

  useEffect(() => {
    const handleAutoLogout = (event: AutoLogoutEvent) => {
      console.log('üîî Auto logout event received:', event.detail)
      
      // Mark that notification has been shown
      const notificationElement = document.createElement('div')
      notificationElement.setAttribute('data-notification-shown', 'true')
      notificationElement.style.display = 'none'
      document.body.appendChild(notificationElement)
      
      // Show custom notification
      showAutoLogoutNotification(event.detail.message)
      
      // Redirect after a short delay
      setTimeout(() => {
        const currentPath = window.location.pathname
        if (currentPath.includes('/admin')) {
          router.push('/admin')
        } else {
          // For regular users, you might want to redirect to login page
          // router.push('/login')
          router.refresh() // Or just refresh the page
        }
      }, 2000)
    }

    // Add event listener for auto logout
    window.addEventListener('autoLogout', handleAutoLogout as EventListener)

    return () => {
      window.removeEventListener('autoLogout', handleAutoLogout as EventListener)
    }
  }, [router])

  return null // This component doesn't render anything
}

function showAutoLogoutNotification(message: string) {
  // Create a simple toast notification
  const notification = document.createElement('div')
  notification.innerHTML = `
    <div style="
      position: fixed;
      top: 20px;
      right: 20px;
      background: #f59e0b;
      color: white;
      padding: 16px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 9999;
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 14px;
      max-width: 300px;
      animation: slideIn 0.3s ease-out;
    ">
      <div style="display: flex; align-items: center; gap: 8px;">
        <span style="font-size: 18px;">‚ö†Ô∏è</span>
        <span>${message}</span>
      </div>
    </div>
  `

  // Add animation styles
  const style = document.createElement('style')
  style.textContent = `
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
  `
  document.head.appendChild(style)

  document.body.appendChild(notification)

  // Auto remove after 5 seconds
  setTimeout(() => {
    const notificationElement = notification.querySelector('div')
    if (notificationElement) {
      notificationElement.style.animation = 'slideOut 0.3s ease-in'
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification)
        }
      }, 300)
    }
  }, 5000)
}